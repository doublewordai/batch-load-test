releases:
  - name: control-layer
    namespace: {{ .Values.namespace }}
    createNamespace: true
    chart: oci://ghcr.io/doublewordai/charts/control-layer
    version: 0.4.5
    secrets:
      - control-layer.enc.yaml
    labels:
      tier: app
      component: control-layer
      env: load-test

  - name: db-init
    namespace: {{ .Values.namespace }}
    chart: ./charts/db-init
    version: 0.1.0
    needs:
      - control-layer
    labels:
      tier: app
      component: control-layer
      env: load-test

  - name: openai-mock
    namespace: {{ .Values.namespace }}
    createNamespace: true
    chart: ./charts/mockai
    version: 0.1.0
    labels:
      tier: app
      component: inference-stack
      env: load-test

  - name: locust
    namespace: {{ .Values.namespace }}
    chart: ./charts/locust
    installed: false
    version: 0.1.0
    needs:
      - control-layer
      - db-init
      - openai-mock
    values:
      - locust-batch-test.yaml
    set:
      - name: locustfile.inline
        file: locust/locustfile.py
      - name: testData.files.batch_input_small\.jsonl
        file: locust/test_data/batch_input_small.jsonl
      - name: testData.files.batch_input_medium\.jsonl
        file: locust/test_data/batch_input_medium.jsonl
      - name: testData.files.batch_input_large\.jsonl
        file: locust/test_data/batch_input_large.jsonl
    labels:
      tier: test
      component: load-test
      env: load-test
